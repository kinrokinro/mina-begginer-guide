<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]>      <html class="no-js"> <!--<![endif]-->
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Mina - гайд для начинающих</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
</head>

<body>
    <!--[if lt IE 7]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="#">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->
    <div class="container">
        <img src="img/mina_logo.png" class="img-fluid logo-image" alt="Logo">
        <div class="row">
            <div class="col-sm">
                <div class="alert alert-success text-center">
                    <p class="mb-0">Последняя версия: [DIRTY]b14e32415b15af04865ca069af31cea7716be251</p>
                    <!-- <p class="mb-0">Время релиза: 09.01.2021 at 06:49 AM UTC</p> -->
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm">
                <p class="text-center">Привет! Этот гайд создан для того, чтобы позволить любому человеку развернуть
                    ноду Mina без особых сложностей.</p>
            </div>
        </div>
        <div class="row">
            <div class="container">
                <div class="col-sm">
                    <h3>1. Установка ключей</h3>
                    <div>
                        Для начала нам нужно подготовить директории для ключей с помощью команды:<br>
                        <!-- <kbd>rm -rf ~/keys</kbd><br> -->
                        <kbd>mkdir ~/keys</kbd><br>
                        Далее вам потребуется ссылка на скачивание ключей (лежит у вас в почте, если вас пустили в тестнет), нужно скачать эти ключи на ваш сервер<br>
                        <kbd>wget -O ~/keys/keys.zip %адрес_на_скачку_ключей_с_почты%</kbd><br>
                        <kbd>apt install unzip</kbd><br>
                        <kbd>cd ~/keys</kbd><br>
                        <kbd>unzip keys.zip</kbd><br>
                        В результате распаковки в папке должны появиться два файла с примерно такими названиями: <kbd>extra_fish_%число%</kbd> и <kbd>extra_fish_%число%.pub</kbd>, нам нужно их переименовать для более удобного обращения в дальнейшем<br>
                        Для этого воспользуемся следующими командами:<br>
                        <kbd>mv extra_fish_%число% mina-wallet</kbd><br>
                        <kbd>mv extra_fish_%число%.pub mina-wallet.pub</kbd><br>
                        <kbd>cd</kbd><br>
                        <kbd>chmod 700 $HOME/keys</kbd><br>
                        <kbd>chmod 600 $HOME/keys/mina-wallet</kbd><br>
                        Далее зададим переменные <kbd>KEYPATH</kbd> и <kbd>MINA_PUBLIC_KEY</kbd> для удобства в дальнейшем и запишем их в <kbd>.bashrc</kbd><br>
                        <kbd>echo 'export KEYPATH=$HOME/keys/mina-wallet' >> $HOME/.bashrc</kbd><br>
                        <kbd>echo 'export MINA_PUBLIC_KEY=$(cat $HOME/keys/mina-wallet.pub)' >> $HOME/.bashrc</kbd><br>
                        <kbd>source ~/.bashrc</kbd><br>
                        Осталось скачать список пиров:<br>
                        <kbd>wget -O ~/peers.txt https://raw.githubusercontent.com/MinaProtocol/coda-automation/bug-bounty-net/terraform/testnets/testworld/peers.txt</kbd>
                        <p class="alert alert-warning mt-3">Внимание! Рекомендуется регулярно обновлять пиры с помощью скрипта <a href="https://github.com/AkiAfroo/minacheckpeers">@AkiAfroo</a>, для этого выполните следующие команды:</a></p>
                        <kbd>wget https://raw.githubusercontent.com/AkiAfroo/minacheckpeers/main/checkpeers</kbd><br>
                        <kbd>chmod +x checkpeers</kbd><br>
                        <kbd>bash checkpeers</kbd><br>
                        <kbd>В появившееся диалоговое окно вводим y (если есть новые пиры), нажимаем Enter</kbd><br>
                        Ноду перезапускать не нужно, повторять периодически командой <kbd>bash checkpeers</kbd><br>
                    </div>
                    <h3>2. Установка ноды на Ubuntu 18.04</h3>
                    <div>
                        Для начала вам может потребоваться открыть порты на сервере, но не всегда это нужно. В любом случае вот команды, которыми это можно сделать:<br>
                        <kbd>sudo apt install ufw</kbd><br>
                        <kbd>sudo ufw allow 22</kbd><br>
                        <kbd>sudo ufw allow 8302</kbd><br>
                        <kbd>sudo ufw allow 8303</kbd><br>
                        <kbd>sudo ufw enable</kbd><br>

                        Далее устанавливаем саму ноду:
                        <kbd>sudo apt-get remove -y coda-testnet-postake-medium-curves</kbd> (выполнять если уже ставили ноду, в любом случае выполнить стоит)<br>
                        <kbd>mkdir .coda-config</kbd><br>
                        <kbd>sudo apt-get update</kbd><br>
                        <kbd>sudo apt-get install -y apt-transport-https ca-certificates</kbd><br>
                        <kbd>echo "deb [trusted=yes] http://packages.o1test.net release main" | sudo tee /etc/apt/sources.list.d/mina.list</kbd><br>
                        <kbd>sudo apt-get update</kbd><br>
                        <kbd>sudo apt-get install -y curl unzip mina-testnet-postake-medium-curves=0.2.2-1-b14e324 --allow-downgrades</kbd><br>
                        Проверьте версию ноды командой <kbd>coda version</kbd>, версия должна быть <kbd>[DIRTY]b14e32415b15af04865ca069af31cea7716be251</kbd><br>
                        Поздравляю! Вы установили ноду Mina.
                    </div>
                    <h3>3. Подготовка к майнингу</h3>
                    <div>
                        Перед стартом нам потребуются последние шаги: импортировать аккаунт и разблокировать ключ (если намерены совершать транзакции, то разблокировать ключ обязательно)<br>
                        <kbd>coda accounts import -privkey-path $KEYPATH</kbd><br>
                        <kbd>coda accounts unlock -public-key $MINA_PUBLIC_KEY</kbd>
                    </div>
                    <h3>4. Запуск ноды</h3>
                    <div>
                        Команда для запуска ноды:<br>
                        <kbd>screen -S mina_node</kbd><br>
                        <kbd>CODA_PRIVKEY_PASS=%ваш_ключ_из_письма_на_почте% coda daemon -peer-list-file ~/peers.txt -block-producer-key ~/keys/wallet -generate-genesis-proof true -file-log-level Info -run-snark-worker $MINA_PUBLIC_KEY -super-catchup</kbd><br>
                        <kbd>Ctrl + A, затем нажимаем D (все делать в английской раскладке)</kbd><br>
                        Для того, чтоб вернуться в окно с нодой (перезапустить в случае падения/посмотреть как дела) выполните команду <kbd>screen -rd mina_node</kbd> (вместо mina_node может быть что угодно, это название вашего screen окна, которое вы указывали выше при создании screen -S)<br>
                        Проверить статус ноды:<br>
                        <kbd>coda client status</kbd><br>
                        или<br>
                        <kbd>watch -n 30 "coda client status | grep -v 'ip4/'"</kbd> - будет проверять статус каждые 30 секунд и обновлять информацию на экране<br>
                        Дождитесь значения Synced в строке Sync status. Поздравляю, нода работает!
                    </div>
                    <h3>5. Установка Snark Stopper'а (опционально)</h3>
                    <div>
                        Снарк стоппер пригодится людям, которые размещают блок продюссера и снарк воркер на одной машине, т.к. снарк воркер расходует все доступные процессорные ресурсы,
                        а данный скрипт останавливает работу снарк воркера если на подходе производство блока.<br>
                        Установка:<br>
                        <kbd>screen -S mina-snark-stopper</kbd><br>
                        <kbd>sudo apt install jq git python3-venv</kbd><br>
                        <kbd>git clone https://github.com/c29r3/mina-snark-stopper.git</kbd><br>
                        <kbd>cd mina-snark-stopper</kbd><br>
                        <kbd>python3 -m venv venv</kbd><br>
                        <kbd>source ./venv/bin/activate</kbd><br>
                        <kbd>pip3 install -r requirements.txt</kbd><br>
                        Настройка:<br>
                        <kbd>nano $HOME/mina-snark-stopper/config.yml</kbd><br>
                        Нужно заменить параметры WORKER_PUB_KEY и WORKER_FEE на желаемые:<br>
                        <kbd>WORKER_PUB_KEY: YOUR_PUBLIC_KEY</kbd> заменить <kbd>YOUR_PUBLIC_KEY</kbd> на <kbd>$MINA_PUBLIC_KEY</kbd><br>
                        <kbd>WORKER_FEE: 1</kbd> заменить <kbd>1</kbd> на желаемую комиссию, рекомендуется значения в пределах <kbd>0.4-0.5</kbd><br>
                        Запуск:<br>
                        <kbd>venv/bin/python3 snark-stopper.py</kbd><br>
                        <kbd>Ctrl + A, затем D (все в английской раскладке)</kbd><br>
                        Просмотр состояния скрипта:<br>
                        <kbd>screen -rd mina-snark-stopper</kbd><br>
                        Выйти из просмотра:<br>
                        <kbd>Ctrl + A, затем D (все в английской раскладке)</kbd>
                    </div>
                    <h3>Полезная информация</h3>
                    <div>
                        <h5>Ссылки</h5>
                        Mina explorer - <a href="https://minaexplorer.com/">minaexplorer.com</a><br>
                        Официальная документация - <a href="https://minaprotocol.com/docs/getting-started">minaprotocol.com</a><br>
                        Mina Snark Stopper - <a href="https://github.com/c29r3/mina-snark-stopper">github.com</a><br>
                        Mina Peers Checker - <a href="https://github.com/AkiAfroo/minacheckpeers">github.com</a>
                        <h5>Команды:</h5>
                        <strong>Производство блоков:</strong><br>
                        <kbd>coda client set-staking -public-key $MINA_PUBLIC_KEY</kbd> - установить производство блоков на адрес $MINA_PUBLIC_KEY<br>
                        <strong>Производство снарков:</strong><br>
                        <kbd>coda client set-snark-worker -address $MINA_PUBLIC_KEY</kbd> - указать снарк воркеру работать на адрес $MINA_PUBLIC_KEY<br>
                        <kbd>coda client set-snark-work-fee 0.5</kbd> - установить комиссию за снарк в размере 0.5 (рекомендуемая комиссия 0.4-0.5)<br>
                        <strong>Отправка транзакций:</strong><br>
                        <kbd>coda client send-payment -amount 0.01 -receiver адрес_получателя -fee 100 -sender $MINA_PUBLIC_KEY</kbd> - отправить транзакцию в размере 0.01 с комиссией 100 по адресу адрес_получателя (для отправки аккаунт должен быть разблокирован командой <kbd>coda accounts unlock -public-key $MINA_PUBLIC_KEY</kbd>)
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="" async defer></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" crossorigin="anonymous">
    </script>
</body>

</html>